var mo=Object.defineProperty;var w=(e,o)=>()=>(e&&(o=e(e=0)),o);var Y=(e,o)=>{for(var t in o)mo(e,t,{get:o[t],enumerable:!0})};var C,J=w(()=>{C="2025-02-12b"});import po from"path";import ho from"fs/promises";import{McpToolset as fo}from"@iqai/adk";async function De(){return await go,te.getTools()}var L,go,te,G=w(()=>{L=po.resolve(process.cwd(),"data/journal"),go=ho.mkdir(L,{recursive:!0}).catch(e=>{throw console.error("[MCP] Failed to create journal directory",e),e}),te=new fo({name:"filesystem-journal",description:"Local journaling store used for user reflections and offline memory.",debug:!1,transport:{mode:"stdio",command:"npx",args:["-y","@modelcontextprotocol/server-filesystem",L],env:{PATH:process.env.PATH??""}}})});import Le from"path";import{fileURLToPath as yo}from"url";import{McpToolset as wo}from"@iqai/adk";async function He(){return oe.getTools()}var bo,vo,oe,qe=w(()=>{bo=Le.dirname(yo(import.meta.url)),vo=Le.resolve(bo,"../servers/webSearch.server.ts"),oe=new wo({name:"web-search",description:"Search and discovery via DuckDuckGo Instant Answer API.",debug:!1,transport:{mode:"stdio",command:"npx",args:["-y","tsx",vo],env:{PATH:process.env.PATH??""}}})});import Be from"path";import{fileURLToPath as To}from"url";import{McpToolset as ko}from"@iqai/adk";async function Fe(){return ne.getTools()}var So,_o,ne,je=w(()=>{So=Be.dirname(To(import.meta.url)),_o=Be.resolve(So,"../servers/wikipedia.server.ts"),ne=new ko({name:"wikipedia-knowledge",description:"Knowledge grounding via Wikipedia summaries and search.",debug:!1,transport:{mode:"stdio",command:"npx",args:["-y","tsx",_o],env:{PATH:process.env.PATH??""}}})});import $e from"path";import{fileURLToPath as xo}from"url";import{McpToolset as Eo}from"@iqai/adk";async function Ue(){return re.getTools()}var Po,Io,re,Ke=w(()=>{Po=$e.dirname(xo(import.meta.url)),Io=$e.resolve(Po,"../servers/unsplash.server.ts"),re=new Eo({name:"unsplash-visuals",description:"Curate Unsplash imagery for mood-based backgrounds and cards.",debug:!1,transport:{mode:"stdio",command:"npx",args:["-y","tsx",Io],env:{PATH:process.env.PATH??"",UNSPLASH_ACCESS_KEY:process.env.UNSPLASH_ACCESS_KEY??""}}})});import Ye from"path";import{fileURLToPath as Ro}from"url";import{McpToolset as Ao}from"@iqai/adk";async function Ge(){return se.getTools()}var No,Oo,se,Ve=w(()=>{No=Ye.dirname(Ro(import.meta.url)),Oo=Ye.resolve(No,"../servers/spotify.server.ts"),se=new Ao({name:"spotify-mood",description:"Mood-aware Spotify playlists and tracks.",debug:!1,transport:{mode:"stdio",command:"npx",args:["-y","tsx",Oo],env:{PATH:process.env.PATH??"",SPOTIFY_CLIENT_ID:process.env.SPOTIFY_CLIENT_ID??"",SPOTIFY_CLIENT_SECRET:process.env.SPOTIFY_CLIENT_SECRET??""}}})});import ze from"path";import{fileURLToPath as Co}from"url";import{McpToolset as Mo}from"@iqai/adk";async function We(){return ae.getTools()}var Do,Lo,ae,Je=w(()=>{Do=ze.dirname(Co(import.meta.url)),Lo=ze.resolve(Do,"../servers/emotion.server.ts"),ae=new Mo({name:"emotion-analytics",description:"Lightweight sentiment and tone analytics for reflections.",debug:!1,transport:{mode:"stdio",command:"npx",args:["-y","tsx",Lo],env:{PATH:process.env.PATH??""}}})});import Qe from"path";import{fileURLToPath as Ho}from"url";import{McpToolset as qo}from"@iqai/adk";async function Xe(){return ie.getTools()}var Bo,Fo,ie,Ze=w(()=>{G();Bo=Qe.dirname(Ho(import.meta.url)),Fo=Qe.resolve(Bo,"../servers/journal.server.ts"),ie=new qo({name:"journal-reflection",description:"Reflection prompts and storage helpers on top of local journal.",debug:!1,transport:{mode:"stdio",command:"npx",args:["-y","tsx",Fo],env:{PATH:process.env.PATH??"",JOURNAL_ROOT:L}}})});import et from"path";import{fileURLToPath as jo}from"url";import{McpToolset as $o}from"@iqai/adk";async function tt(){return ce.getTools()}var Uo,Ko,ce,ot=w(()=>{Uo=et.dirname(jo(import.meta.url)),Ko=et.resolve(Uo,"../servers/trends.server.ts"),ce=new $o({name:"google-trends",description:"Google Trends insights for wellness and productivity topics.",debug:!1,transport:{mode:"stdio",command:"npx",args:["-y","tsx",Ko],env:{PATH:process.env.PATH??""}}})});import nt from"path";import{fileURLToPath as Yo}from"url";import{McpToolset as Go}from"@iqai/adk";async function rt(){return le.getTools()}var Vo,zo,le,st=w(()=>{Vo=nt.dirname(Yo(import.meta.url)),zo=nt.resolve(Vo,"../servers/quotes.server.ts"),le=new Go({name:"zenquotes-feed",description:"Positive affirmations and quotes for uplifting replies.",debug:!1,transport:{mode:"stdio",command:"npx",args:["-y","tsx",zo],env:{PATH:process.env.PATH??""}}})});function at(e){if(!e)return"Unknown error";if(typeof e=="string")return e;if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch{return String(e)}}var it=w(()=>{});import{AgentBuilder as Wo,createTool as Jo}from"@iqai/adk";import{z as Q}from"@iqai/adk/node_modules/zod";async function Qo(){if(!ue){if(!process.env.GOOGLE_API_KEY)throw new Error("summarize_reflections requires GOOGLE_API_KEY to be configured for the Gemini model.");ue=Wo.create("WeeklyMoodSummarizer").withModel("gemini-2.5-flash").withInstruction(["You are a cozy Gen-Z productivity coach.","Summarize journal/check-in entries into positive, honest recaps.","Respond strictly in JSON with keys: summary (string), highlights (array of strings), action_items (array of strings).","Keep tone uplifting, slang-light, and under 120 words per field."].join(`
`)).build().then(e=>e.runner)}return ue}function ct(){return[Zo]}var ue,Xo,Zo,lt=w(()=>{it();ue=null;Xo=Q.object({entries:Q.array(Q.string().min(1,"Entries cannot be blank")).min(1,"Provide at least one entry to summarize"),focus:Q.string().min(1).optional()}),Zo=Jo({name:"summarize_reflections",description:"Digest a batch of journal or chat entries into a Gen-Z friendly weekly recap, returning highlights, mood notes, and actionable next-steps as structured JSON for downstream coaching.",schema:Xo,fn:async({entries:e,focus:o})=>{let t=e.map(p=>p.trim()),n=await Qo(),r=[o?`Focus on: ${o}. Keep it encouraging and actionable.`:"Provide a balanced, encouraging recap.","Entries:"].concat(t.map((p,u)=>`${u+1}. ${p.replace(/\s+/g," ")}`)).join(`
`),a;try{a=await n.ask(r)}catch(p){return{summary:"",highlights:t.slice(0,Math.min(3,t.length)),action_items:[],warning:`Summarizer request failed: ${at(p)}`}}try{let p=typeof a=="string"?a.trim():String(a),u=p.indexOf("{"),m=p.lastIndexOf("}");if(u===-1||m===-1)throw new Error("No JSON object found in summarizer response.");return JSON.parse(p.slice(u,m+1))}catch{return{summary:String(a),highlights:t.slice(0,3),action_items:["Take a mindful break","Hydrate","Message a friend"],warning:"Summarizer response was not valid JSON; returning fallback."}}}})});import en from"fs/promises";import tn from"path";async function me(e){let o=new Date().toISOString().slice(0,10),t=tn.join(L,`${o}.txt`),r=`[${new Date().toTimeString().slice(0,5)}] ${e}
`;return await en.appendFile(t,r,"utf8"),t}var de=w(()=>{G()});import{createTool as x}from"@iqai/adk";import{createEvent as on}from"ics";import{z as s}from"@iqai/adk/node_modules/zod";function pt(e,o){return new Date(e.getTime()+o*6e4)}function he(e){let o=e?new Date(e):new Date;if(Number.isNaN(o.getTime()))throw new Error(`Invalid date format: ${e}`);return o}function nn(e){return{iso:e.toISOString(),localDate:e.toLocaleDateString(),localTime:e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}function rn(e){let o=new Map;for(let t of e){let n=t.toISOString();o.has(n)||o.set(n,t)}return Array.from(o.values()).sort((t,n)=>t.getTime()-n.getTime())}async function ht(){let e=x({name:"schedule_mood_check_in",description:"Plan a sequence of mood check-ins with smart reminders and reflection prompts.",schema:s.object({startTime:s.string().optional(),intervalMinutes:s.number().int().min(10).max(1440).optional(),count:s.number().int().min(1).max(12).optional(),customTimes:s.array(s.string()).optional()}),fn:async({startTime:i,intervalMinutes:c=180,count:d=3,customTimes:l})=>{let h=[];if(l?.length)h=l.map(he);else{let f=he(i);h=Array.from({length:d},(b,I)=>I===0?f:pt(f,c*I))}let _=rn(h.filter(f=>f.getTime()>Date.now())).map((f,b)=>({label:`Check-in ${b+1}`,...nn(f),prompt:b===0?"Ask how their energy feels right now.":"Reflect on any shifts since the last check-in."}));if(!_.length)throw new Error("All scheduled times were in the past. Provide future timestamps.");return{intervalMinutes:c,plannedCount:_.length,reminders:_,followUpSuggestions:["Log insights in the journal tool to see trends later.","If energy keeps dipping, suggest nourishment or rest."]}}}),o=x({name:"breathing_coach",description:"Guide the user through structured breathing with cycle timing and coaching notes.",schema:s.object({pattern:s.enum(["box","four_seven_eight","resonance","balanced_reset","rescue"]).optional(),cycles:s.number().int().min(1).max(12).optional(),includeAffirmations:s.boolean().optional()}),fn:async({pattern:i="box",cycles:c=4,includeAffirmations:d=!1})=>{let l={box:{name:"Box breathing 4-4-4-4",steps:[{cue:"Inhale steadily",seconds:4},{cue:"Hold softly",seconds:4},{cue:"Exhale slowly",seconds:4},{cue:"Hold at the bottom",seconds:4}],focus:"Stabilise the nervous system and regain focus."},four_seven_eight:{name:"4-7-8 calming breath",steps:[{cue:"Inhale through nose",seconds:4},{cue:"Hold gently",seconds:7},{cue:"Exhale with a sigh",seconds:8}],focus:"Lower tension and ease anxious spikes."},resonance:{name:"Resonance breathing (~6 breaths/min)",steps:[{cue:"Inhale",seconds:5},{cue:"Exhale",seconds:5}],focus:"Support heart rate variability and calm focus."},balanced_reset:{name:"Balanced reset 5-5-5",steps:[{cue:"Inhale",seconds:5},{cue:"Hold",seconds:5},{cue:"Exhale",seconds:5}],focus:"Reset between meetings or intense tasks."},rescue:{name:"Rescue breath (long exhale)",steps:[{cue:"Inhale",seconds:2},{cue:"Exhale slowly",seconds:6}],focus:"Release acute stress when you need quick relief."}},h=l[i]??l.box,S=c*h.steps.reduce((f,b)=>f+b.seconds,0),_=d?["Breath in: I am safe to pause.","Hold: I am present with what is real.","Exhale: I release what I no longer need."]:void 0;return{pattern:h.name,focus:h.focus,cycles:c,totalDurationSeconds:S,cycleBlueprint:h.steps,affirmations:_,debriefPrompt:"Ask how their body feels now versus before starting."}}}),t=x({name:"log_micro_habit",description:"Track micro habits and return coaching tips tailored to the action.",schema:s.object({habit:s.string().min(2),action:s.enum(["start","complete","skip"]),friction:s.enum(["none","low","medium","high"]).optional(),notes:s.string().optional()}),fn:async({habit:i,action:c,friction:d="low",notes:l})=>{let h={start:"Momentum started. Remind them a small win still counts.",complete:"Celebrate the follow-through. Reinforce what made it work.",skip:"Normalize the skip and identify what support they need next."},S={none:"They feel clear\u2014ask what helped and lock it in.",low:"Notice gentle resistance and plan the next trigger.",medium:"Encourage breaking it down further or pairing with a cue.",high:"Explore what blocked them first; maybe the habit needs re-scoping."};return{habit:i,action:c,statusSummary:h[c],friction:d,frictionAdvice:S[d],notes:l}}}),n=x({name:"energy_level_survey",description:"Log current energy (1-5) and map it to action ideas, escalation prompts, and recovery tips.",schema:s.object({energy:s.number().int().min(1).max(5),tags:s.array(s.string()).max(5).optional()}),fn:async({energy:i,tags:c})=>{let d=["Drained","Low","Steady","Elevated","Peak"],l=[["Suggest rest, water, and emotional check-in."],["Recommend gentle tasks or planning tomorrow."],["Propose a focus sprint or tidy-up tasks."],["Great moment for creative or social work."],["Channel into priority work, then cool down."]],h=i<=2?"If they mention burnout signs, suggest a break and revisit nutrition, sleep, or emotional load.":null,S=i>=4?["Plan a celebration when work wraps.","Invite them to note what conditions created this energy."]:["Encourage a hydration check.","Ask what would recharge them fastest."];return{energy:i,label:d[i-1],suggestions:l[i-1],escalation:h,recoveryPrompts:S,tags:c}}}),r=x({name:"plan_focus_timer",description:"Generate a Pomodoro or custom focus schedule with cumulative timing and reflection cues.",schema:s.object({workMinutes:s.number().int().min(10).max(75).optional(),breakMinutes:s.number().int().min(3).max(25).optional(),cycles:s.number().int().min(1).max(8).optional(),includeLongBreak:s.boolean().optional()}),fn:async({workMinutes:i=25,breakMinutes:c=5,cycles:d=4,includeLongBreak:l=!0})=>{let h=Array.from({length:d},(f,b)=>{let I=l&&(b+1)%4===0&&b+1!==d?Math.max(c*3,15):c;return{cycle:b+1,workMinutes:i,breakMinutes:b===d-1?0:I,checkIn:b===0?"Set intention for this block.":"Note progress / obstacles."}}),S=d*i,_=h.reduce((f,b)=>f+b.breakMinutes,0);return{plan:h,totals:{focusMinutes:S,breakMinutes:_,ratio:Number((S/Math.max(_,1)).toFixed(2))},suggestions:["Invite the user to log a sentence after each block.","Encourage a longer decompression after the full set completes."]}}}),a=x({name:"stretch_move_library",description:"Provide targeted movement suggestions with duration and micro coaching.",schema:s.object({focus:s.enum(["neck","back","eyes","shoulders","full"]).optional(),limit:s.number().int().min(1).max(5).optional()}),fn:async({focus:i="full",limit:c=3})=>{let l=(ut[i]??ut.full).slice(0,c);return{focus:i,suggestions:l,reminder:"Ask the user to set a timer and notice tension release afterwards."}}}),p=x({name:"summarize_sleep_log",description:"Analyze a batch of sleep logs, compute averages, and suggest adjustments.",schema:s.object({entries:s.array(s.object({date:s.string(),hours:s.number().min(0).max(24),quality:s.number().min(1).max(5).optional(),notes:s.string().optional()})).min(1).max(30)}),fn:async({entries:i})=>{let d=i.reduce((f,b)=>f+b.hours,0)/i.length,l=i.map(f=>f.quality).filter(Boolean),h=l.length?l.reduce((f,b)=>f+b,0)/l.length:null,S=i.filter(f=>f.hours<6),_=i.reduce((f,b)=>b.hours>f.hours?b:f);return{nightsLogged:i.length,averageHours:Number(d.toFixed(2)),averageQuality:h?Number(h.toFixed(2)):null,shortestNight:S.length?S[0]:null,longestNight:_,recommendations:d<7?["Encourage a consistent bedtime and dimming screens 30 minutes before sleep.","Suggest a short wind-down routine logged in the journal."]:["Help them protect current sleep habits.","Introduce a gentle morning ritual to sustain rest quality."]}}}),u=x({name:"nutrition_prompt_helper",description:"Offer hydration and nourishment prompts based on recent intake cues.",schema:s.object({lastMealMinutesAgo:s.number().int().min(0).max(1440).optional(),hydrationCups:s.number().int().min(0).max(24).optional(),craving:s.string().optional()}),fn:async({lastMealMinutesAgo:i,hydrationCups:c,craving:d})=>{let l=[];return i!==void 0&&(i>=300?l.push("Recommend a substantial meal. Neutral tone, no shame."):i>=180?l.push("Suggest a protein + carb snack to stabilise energy."):i>=120?l.push("Invite them to prep a light bite before hunger spikes."):l.push("Meal timing is solid\u2014cheer on the consistency.")),c!==void 0&&(c<3?l.push("Prompt a glass of water now and note how it feels after."):c>10?l.push("Hydration looks high\u2014make sure electrolytes are balanced."):l.push("Hydration zone is healthy\u2014celebrate and keep nearby water.")),d&&l.push(`Encourage them to pair ${d} with fiber or protein for steady energy.`),{suggestions:l,note:"Remind them that nourishment fuels focus\u2014no guilt, just care."}}}),m=x({name:"recommend_care_resources",description:"Return curated articles, videos, or podcasts for wellness topics.",schema:s.object({topic:s.string().min(3),format:s.enum(["article","video","podcast","any"]).optional(),limit:s.number().int().min(1).max(5).optional()}),fn:async({topic:i,format:c="any",limit:d=3})=>{let l=i.toLowerCase(),h=mt[l]??mt.focus,_=(c==="any"?h:h.filter(f=>f.type===c)).slice(0,d);return{topic:l,results:_,fallback:_.length?null:"Try reading mode on DuckDuckGo search for more resources."}}}),y=x({name:"log_gratitude_entry",description:"Append a gratitude line to the shared journal with optional prompts.",schema:s.object({entry:s.string().min(3),promptRequested:s.boolean().optional(),tags:s.array(s.string().min(2)).max(5).optional()}),fn:async({entry:i,promptRequested:c=!1,tags:d})=>{let l=c?dt[Math.floor(Math.random()*dt.length)]:void 0,h=`[gratitude] ${i}${d?.length?` | tags: ${d.join(", ")}`:""}`;return{savedTo:await me(h),prompt:l,reminder:"Invite them to revisit gratitude notes on rough days."}}}),v=x({name:"generate_personalized_compliment",description:"Generate a motivating compliment keyed to the achievement and tone.",schema:s.object({focus:s.enum(["consistency","bravery","progress","care","resilience"]).optional(),persona:s.enum(["gentle","hype","witty"]).optional(),name:s.string().optional()}),fn:async({focus:i="progress",persona:c="gentle",name:d})=>{let l={gentle:{consistency:"Your steadiness is quietly rewriting your story.",bravery:"You stepped toward the hard thing\u2014proof you trust yourself.",progress:"Every tiny move counts; you\u2019re building more than you see.",care:"Choosing rest is resistance. I\u2019m proud of your tenderness.",resilience:"You bend, you recover, you rise stronger each time."},hype:{consistency:"You\u2019re stacking wins like a legend\u2014no off days here.",bravery:"That move took main-character energy and you owned it.",progress:"Plot twist: you\u2019re unstoppable when you chase the next step.",care:"Self-care king/queen alert! You\u2019re literally glowing.",resilience:"Bounce-back level: elite. Nothing keeps you down."},witty:{consistency:"Look at you, quietly building an empire of good habits.",bravery:"You basically just high-fived your own courage.",progress:"Slow clap\u2014your momentum has entered the chat.",care:"Self-kindness unlocked: legendary tier.",resilience:"Like a boomerang with better boundaries. You keep coming back."}};return{compliment:`${d?`${d}, `:""}${l[c][i]}`,focus:i,persona:c}}}),g=x({name:"plan_goal_ladder",description:"Break a goal into structured steps with focus prompts and support ideas.",schema:s.object({goal:s.string().min(4),steps:s.number().int().min(3).max(8).optional(),timelineDays:s.number().int().min(1).max(60).optional()}),fn:async({goal:i,steps:c=5,timelineDays:d=14})=>{let l=["Define what success looks like in one sentence.","List resources or allies you can call on.","Set the very next action you can do in under 10 minutes.","Identify what might block you and plan a backup.","Choose a check-in date to review progress.","Describe how you will celebrate finishing.","Decide how you will maintain the result afterwards.","Note a mantra to keep you steady when it gets tough."],h=Array.from({length:c},(S,_)=>({step:_+1,question:l[_]}));return{goal:i,timelineDays:d,ladder:h,suggestion:"Work through the prompts together and capture answers in the journal."}}}),T=x({name:"reflect_on_conflict",description:"Surface prompts to process a conflict with empathy and boundaries.",schema:s.object({situation:s.string().min(5),emotion:s.string().optional(),intention:s.enum(["repair","closure","self-care"]).optional()}),fn:async({situation:i,emotion:c,intention:d="self-care"})=>({situation:i,intention:d,prompts:["What need of yours felt unheard in that moment?","If you paused the scene, what support would you offer your past self?","Which boundary do you need to restate or rebuild?","Is there a repair you want, or do you need distance to heal?","How can you take care of your nervous system in the next hour?"],emotion:c})}),U=x({name:"mix_mood_playlist",description:"Translate mood + energy into Spotify seed ideas and playlist prompts.",schema:s.object({mood:s.string().min(3),energy:s.enum(["low","medium","high"]).optional(),need:s.enum(["focus","comfort","celebration","release"]).optional()}),fn:async({mood:i,energy:c="medium",need:d="focus"})=>{let l={focus:["focus","study","piano"],comfort:["acoustic","calm","winter-chill"],celebration:["dance","pop","feel-good"],release:["mellow","rainy-day","indie"]},h={low:["soft","ambient"],medium:["steady","lofi"],high:["high-energy","confidence"]};return{mood:i,energy:c,need:d,seeds:[...l[d]??l.focus,...h[c]],followUp:[`Try \`spotify_vibe_playlists\` with "${i} ${h[c][0]}"`,"If it misses, pivot to a comfort playlist they already love."]}}}),N=x({name:"select_ambient_sound",description:"Serve curated ambient soundtracks with quick descriptions.",schema:s.object({vibe:s.enum(["rain","cafe","forest","lofi","minimal","ocean"]).optional(),limit:s.number().int().min(1).max(4).optional()}),fn:async({vibe:i="lofi",limit:c=2})=>{let d={rain:[{label:"Soft rain on window",url:"https://www.youtube.com/watch?v=DWcJFNfaw9c",description:"Gentle rain with occasional thunder for steady focus."},{label:"Rain in library",url:"https://www.youtube.com/watch?v=7NOSDKb0HlU",description:"Rainfall with muffled pages and ambience."}],cafe:[{label:"Lo-fi caf\xE9 ambiance",url:"https://www.youtube.com/watch?v=lTRiuFIWV54",description:"Light chatter and espresso machines."},{label:"Morning caf\xE9",url:"https://www.youtube.com/watch?v=5qap5aO4i9A",description:"Soft jazz with warm caf\xE9 noise."}],forest:[{label:"Forest morning",url:"https://www.youtube.com/watch?v=OdIJ2x3nxzQ",description:"Birdsong and light breeze."},{label:"Night forest",url:"https://www.youtube.com/watch?v=VSS-7Ia6cYc",description:"Crickets and gentle stream for calm evenings."}],lofi:[{label:"lofi hip hop radio",url:"https://www.youtube.com/watch?v=jfKfPfyJRdk",description:"Classic lofi beats for study or work."},{label:"lofi piano focus",url:"https://www.youtube.com/watch?v=1ZYbU82GVz4",description:"Soft piano loops with minimal percussion."}],minimal:[{label:"Brown noise",url:"https://www.youtube.com/watch?v=HdFTGSY4-7E",description:"Low consistent brown noise for deep focus."},{label:"Calm air purifier",url:"https://www.youtube.com/watch?v=HNl9xWJxUgw",description:"Gentle white noise with soft airflow."}],ocean:[{label:"Ocean waves",url:"https://www.youtube.com/watch?v=HM6kXl_ItLE",description:"Rolling waves with seagulls afar."}]},l=d[i]??d.lofi;return{vibe:i,options:l.slice(0,c),suggestion:"Check in after two minutes and adjust volume or vibe."}}}),O=x({name:"create_focus_event_ics",description:"Generate an ICS snippet for focus or rest blocks with structured metadata.",schema:s.object({title:s.string().min(3),start:s.string(),durationMinutes:s.number().int().min(5).max(600).optional(),description:s.string().optional(),location:s.string().optional(),uid:s.string().optional()}),fn:async({title:i,start:c,durationMinutes:d=45,description:l,location:h,uid:S})=>{let f=he(c),b=!1;f.getTime()<Date.now()&&(f=new Date(Date.now()+300*1e3),b=!0);let I=pt(f,d),W={title:i,start:[f.getFullYear(),f.getMonth()+1,f.getDate(),f.getHours(),f.getMinutes()],end:[I.getFullYear(),I.getMonth()+1,I.getDate(),I.getHours(),I.getMinutes()]};l&&(W.description=l),h&&(W.location=h),S&&(W.uid=S);let{error:Me,value:uo}=on(W);if(Me)throw Me;return{title:i,durationMinutes:d,ics:uo,hint:"Share the snippet and remind them to add an alert on their calendar.",note:b?"Start time was nudged five minutes into the future because the provided start was in the past.":void 0}}}),K=x({name:"locate_crisis_resources",description:"Return crisis support contacts by country with fallback options.",schema:s.object({country:s.string().optional(),concern:s.enum(["self-harm","substance","abuse","unspecified"]).optional()}),fn:async({country:i="INTERNATIONAL"})=>{let c=i.toUpperCase(),d=pe[c]??pe[c.slice(0,2)]??pe.INTERNATIONAL;return{country:c,resources:d,instructions:["If someone is in immediate danger, instruct them to call local emergency services.","Stay with the user (digitally) until they confirm they have contacted help."]}}});return[e,o,t,n,r,a,p,u,m,y,v,g,T,U,N,O,K]}var ut,mt,dt,pe,ft=w(()=>{de();ut={neck:[{name:"Neck roll",instructions:"Drop chin to chest and roll left to right slowly.",durationSeconds:20},{name:"Ear-to-shoulder hold",instructions:"Tilt ear toward shoulder, hold and breathe.",durationSeconds:30}],back:[{name:"Seated cat-cow",instructions:"Arch then round spine while seated, one breath per move.",durationSeconds:40},{name:"Standing forward fold",instructions:"Hinge at hips, let arms drop and release shoulders.",durationSeconds:45}],eyes:[{name:"20-20-20 reset",instructions:"Look 20 feet away for 20 seconds every 20 minutes.",durationSeconds:20},{name:"Figure eight tracing",instructions:"Trace a sideways 8 with eyes slowly without moving head.",durationSeconds:30}],shoulders:[{name:"Shoulder rolls",instructions:"Ten forward, ten backward, elbows heavy.",durationSeconds:40},{name:"Doorway chest opener",instructions:"Rest forearms on doorway and lean forward gently.",durationSeconds:30}],full:[{name:"Standing quad stretch",instructions:"Hold ankle behind you, knees together, switch sides.",durationSeconds:40},{name:"Calf raises",instructions:"Rise onto toes slowly for 15 controlled repetitions.",durationSeconds:60}]},mt={burnout:[{title:"Burnout recovery checklist",url:"https://www.everydayhealth.com/wellness/mental-health/recovery-plan-for-burnout/",type:"article"},{title:"How to make stress your friend",url:"https://www.ted.com/talks/kelly_mcgonigal_how_to_make_stress_your_friend",type:"video"},{title:"The Happiness Lab \u2013 Burnout answers",url:"https://www.pushkin.fm/podcasts/the-happiness-lab-with-dr-laurie-santos/before-you-burnout",type:"podcast"}],anxiety:[{title:"Grounding techniques that work fast",url:"https://www.healthline.com/health/grounding-techniques",type:"article"},{title:"Box breathing tutorial",url:"https://www.youtube.com/watch?v=V8SLXjK7dXk",type:"video"},{title:"The Anxious Achiever",url:"https://hbr.org/podcast/2021/03/the-anxious-achiever",type:"podcast"}],focus:[{title:"Deep work quick start guide",url:"https://www.calnewport.com/blog/2016/12/21/a-deep-habits-guide-to-working-less-and-producing-more/",type:"article"},{title:"Pomodoro walkthrough",url:"https://www.youtube.com/watch?v=mNBmG24djoY",type:"video"},{title:"Focused podcast",url:"https://www.relay.fm/focused",type:"podcast"}],grief:[{title:"Coping with grief and loss",url:"https://www.helpguide.org/articles/grief/coping-with-grief-and-loss.htm",type:"article"},{title:"How to talk about grief",url:"https://www.youtube.com/watch?v=khkJkR-ipfw",type:"video"},{title:"Terrible, Thanks for Asking",url:"https://www.terriblethanksforasking.com/",type:"podcast"}]},dt=["What lifted your mood even slightly today?","Name a person who showed up for you recently.","Which part of your body deserves appreciation right now?","Recall a tiny surprise that made you pause.","What is one thing you are learning to be grateful for?"],pe={US:[{name:"988 Suicide & Crisis Lifeline",phone:"988",text:"Text 988",web:"https://988lifeline.org"},{name:"Crisis Text Line",text:"Text HOME to 741741",web:"https://www.crisistextline.org"}],CA:[{name:"988 Suicide Crisis Helpline",phone:"988",web:"https://988.ca"},{name:"Kids Help Phone",phone:"1-800-668-6868",text:"Text CONNECT to 686868",web:"https://kidshelpphone.ca"}],UK:[{name:"Samaritans",phone:"116 123",web:"https://www.samaritans.org"},{name:"Shout Crisis Text Line",text:"Text SHOUT to 85258",web:"https://giveusashout.org"}],AU:[{name:"Lifeline Australia",phone:"13 11 14",web:"https://www.lifeline.org.au"},{name:"Beyond Blue",phone:"1300 22 4636",web:"https://www.beyondblue.org.au"}],NZ:[{name:"1737 Need to talk?",phone:"1737",text:"Text 1737"},{name:"Youthline",phone:"0800 376 633",text:"Text 234",web:"https://www.youthline.co.nz"}],SG:[{name:"Samaritans of Singapore",phone:"1767",web:"https://sos.org.sg"},{name:"IMH Mental Health Helpline",phone:"6389 2222",web:"https://www.imh.com.sg"}],IN:[{name:"Kiran Mental Health Helpline",phone:"1800-599-0019"},{name:"Snehi India",phone:"+91-9582208181",web:"https://snehi.org"}],ZA:[{name:"SADAG Suicide Crisis Line",phone:"0800 567 567",web:"https://www.sadag.org"},{name:"Lifeline South Africa",phone:"0861 322 322"}],BR:[{name:"Centro de Valoriza\xE7\xE3o da Vida",phone:"188",web:"https://www.cvv.org.br"}],MX:[{name:"L\xEDnea de la Vida",phone:"800 911 2000",text:"WhatsApp 55 1161 1111",web:"https://www.gob.mx/salud"}],PH:[{name:"Hopeline PH",phone:"02-8804-4673",text:"0918-873-4673",web:"https://www.ngf-hope.org"}],INTERNATIONAL:[{name:"Befrienders Worldwide",web:"https://www.befrienders.org"},{name:"Find a helpline",web:"https://findahelpline.com"}]}});import{createTool as sn}from"@iqai/adk";import{z as q}from"@iqai/adk/node_modules/zod";async function ln(e,o){let t=await fetch(`https://api.telegram.org/bot${e}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),n=await t.json();if(!t.ok||n?.ok===!1){let r=n?.description??t.statusText;throw new Error(`Telegram API error: ${r}`)}return n}async function gt(){let e=[];for(let o of an){let t=process.env[o.tokenEnv];if(!t)continue;let n=process.env[o.usernameEnv],r=sn({name:o.toolName,description:`Send a Telegram message as ${o.name}.`+(n?` Defaults to chat ${n}.`:" Provide chatId explicitly."),schema:cn,fn:async({chatId:a,text:p,parseMode:u,disableNotification:m,disableWebPagePreview:y})=>{let v=a??n;if(!v)throw new Error("chatId is required for this bot because no default chat is configured.");let g={chat_id:v,text:p};u&&(g.parse_mode=u),m!==void 0&&(g.disable_notification=m),y!==void 0&&(g.disable_web_page_preview=y);let T=await ln(t,g);return{ok:!0,chat:T?.result?.chat??null,messageId:T?.result?.message_id??null,date:T?.result?.date??null}}});e.push(r)}return e}var an,cn,yt=w(()=>{an=[{name:"Helena",tokenEnv:"HELENA_TOKEN",usernameEnv:"HELENA_USERNAME",toolName:"Helena_telegram"},{name:"Milo",tokenEnv:"MILO_TOKEN",usernameEnv:"MILO_USERNAME",toolName:"Milo_telegram"},{name:"Kai",tokenEnv:"KAI_TOKEN",usernameEnv:"KAI_USERNAME",toolName:"Kai_telegram"},{name:"Sophie",tokenEnv:"SOPHIE_TOKEN",usernameEnv:"SOPHIE_USERNAME",toolName:"Sophie_telegram"},{name:"Luna",tokenEnv:"LUNA_TOKEN",usernameEnv:"LUNA_USERNAME",toolName:"Luna_telegram"}],cn=q.object({chatId:q.string().optional(),text:q.string().min(1,"Message text cannot be empty"),parseMode:q.enum(["Markdown","MarkdownV2","HTML"]).optional(),disableWebPagePreview:q.boolean().optional(),disableNotification:q.boolean().optional()})});import{createTool as un}from"@iqai/adk";import{z as P}from"@iqai/adk/node_modules/zod";async function pn(e,o,t){let n=await fetch(`https://discord.com/api/v10/channels/${o}/messages`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bot ${e}`},body:JSON.stringify(t)}),r=await n.json().catch(()=>{});if(!n.ok){let a=r?.message??n.statusText;throw new Error(`Discord API error: ${a}`)}return r}async function wt(){let e=[];for(let o of mn){let t=process.env[o.tokenEnv];if(!t)continue;let n=process.env[o.channelEnv],r=un({name:o.toolName,description:`Send a Discord message as ${o.name}.`+(n?` Defaults to channel ${n}.`:" Provide channelId explicitly."),schema:dn,fn:async({channelId:a,content:p,tts:u,embeds:m,threadId:y})=>{let v=a??n;if(!v)throw new Error("channelId is required because no default channel is configured for this bot.");let g={content:p};u!==void 0&&(g.tts=u),m&&(g.embeds=m),y&&(g.thread_id=y);let T=await pn(t,v,g);return{ok:!0,channelId:v,messageId:T?.id??null,timestamp:T?.timestamp??null}}});e.push(r)}return e}var mn,dn,bt=w(()=>{mn=[{name:"Helena",tokenEnv:"HELENA_DISCORD_TOKEN",channelEnv:"HELENA_DISCORD_CHANNEL",toolName:"Helena_discord"},{name:"Milo",tokenEnv:"MILO_DISCORD_TOKEN",channelEnv:"MILO_DISCORD_CHANNEL",toolName:"Milo_discord"},{name:"Kai",tokenEnv:"KAI_DISCORD_TOKEN",channelEnv:"KAI_DISCORD_CHANNEL",toolName:"Kai_discord"},{name:"Sophie",tokenEnv:"SOPHIE_DISCORD_TOKEN",channelEnv:"SOPHIE_DISCORD_CHANNEL",toolName:"Sophie_discord"},{name:"Luna",tokenEnv:"LUNA_DISCORD_TOKEN",channelEnv:"LUNA_DISCORD_CHANNEL",toolName:"Luna_discord"}],dn=P.object({channelId:P.string().optional(),content:P.string().min(1,"Message content cannot be empty"),tts:P.boolean().optional(),embeds:P.array(P.object({title:P.string().optional(),description:P.string().optional(),url:P.string().optional(),color:P.number().int().optional()})).optional(),threadId:P.string().optional()})});import{McpIqWiki as hn}from"@iqai/adk";var vt,fe,ge,ye=w(()=>{G();qe();je();Ke();Ve();Je();Ze();ot();st();lt();ft();yt();bt();vt=hn(),fe=[{name:"local-journal-filesystem",loader:De,toolset:te},{name:"search-discovery",loader:He,toolset:oe},{name:"knowledge-wikipedia",loader:Fe,toolset:ne},{name:"knowledge-iqwiki",loader:async()=>vt.getTools(),toolset:vt},{name:"visuals-unsplash",loader:Ue,toolset:re},{name:"music-spotify",loader:Ge,toolset:se},{name:"emotion-analytics",loader:We,toolset:ae},{name:"journal-reflection",loader:Xe,toolset:ie},{name:"web-trends",loader:tt,toolset:ce},{name:"quotes-feed",loader:rt,toolset:le},{name:"ai-summarizer",loader:async()=>ct()},{name:"wellness-companion",loader:async()=>ht()}];fe.push({name:"telegram-persona",loader:async()=>gt()});fe.push({name:"discord-persona",loader:async()=>wt()});ge=fe});async function fn(){return(await Promise.all(ge.map(async({name:o,loader:t})=>{try{return await t()}catch(n){return console.error(`[MCP] Failed to load toolset ${o}:`,n),[]}}))).flat()}async function ke(){return we&&ve===C?we:((!be||ve!==C)&&(be=fn().then(e=>(we=e,ve=C,e))),be)}async function Te(){await Promise.all(ge.map(async({toolset:e,name:o})=>{if(e)try{await e.dispose()}catch(t){console.error(`[MCP] Error disposing toolset ${o}:`,t)}}))}var we,be,ve,Tt=w(()=>{ye();J();ye();we=null,be=null,ve=null;typeof process<"u"&&(process.once("exit",()=>{Te()}),process.once("SIGINT",()=>{Te().finally(()=>process.exit(0))}))});var kt=w(()=>{Tt();de();G()});async function gn(){return(!Se||St!==C)&&(Se=ke(),St=C),Se}async function R(e){let o=await gn();if(!e)return o.slice();let t=e.toLowerCase();return o.filter(n=>n?.name&&(n.name.endsWith("_telegram")||n.name.endsWith("_discord"))?n.name.split("_")[0]?.toLowerCase()===t:!0)}var Se,St,B=w(()=>{kt();J();Se=null,St=null});function A(e){let o=e?.toLowerCase(),t=o&&_t[o]?`Messaging \u2013 Telegram
- \`${_t[o]}\`: send a Telegram message as your bot. Provide \`chatId\` if no default username is configured.`:`Messaging \u2013 Telegram
- Dedicated persona tool available (e.g. Helena_telegram).`,n=o&&xt[o]?`Messaging \u2013 Discord
- \`${xt[o]}\`: send a Discord message as your bot. Provide \`channelId\` if no default channel is configured.`:`Messaging \u2013 Discord
- Dedicated persona tool available (e.g. Helena_discord).`;return`
TOOLS 101 (55 total). If someone asks for your tool list, respond from this cheat-sheet\u2014no tool call is required. Before invoking any tool: state why, confirm inputs, and explain results or errors.

File reading
- \`read_text_file(path, head?, tail?)\`: get plain text. Use for config, markdown, code.
- \`read_file(path, head?, tail?)\`: raw bytes or mixed encoding. Use for JSON/binary blobs.
- \`read_media_file(path)\`: image/audio \u2192 base64 + mime. Only when file path is known.
- \`read_multiple_files(paths)\`: compare several files at once.

File writing + editing
- \`write_file(path, content)\`: create or replace entire file. Warn if overwrite.
- \`edit_file(path, edits, dryRun?)\`: apply diff-style edits; use dry run first.
- \`move_file(source, destination)\`: rename or relocate; confirm destination exists/desired.

Folders + metadata
- \`create_directory(path)\`: make folders (recursive). Mention target path.
- \`list_directory(path)\`: quick listing.
- \`list_directory_with_sizes(path, sortBy?)\`: listing with sizes and sort.
- \`directory_tree(path)\`: nested snapshot for navigation.
- \`list_allowed_directories()\`: show sandbox roots before heavy work.
- \`search_files(path, pattern, exclude?)\`: find files by glob/regex.
- \`get_file_info(path)\`: stat info (size, timestamps, type).

General knowledge
- \`web_search(query, maxResults?)\`: DuckDuckGo instant answers when encyclopedias fail.
- \`wikipedia_search(query, limit?)\`: find page titles first.
- \`wikipedia_summary(title)\`: fetch summary using title from search.
- \`SEARCH_WIKI(query)\`: find IQ.wiki slugs (use before ID-based calls).
- \`GET_WIKI(id)\`: fetch IQ.wiki article. Needs valid slug (e.g. "bitcoin").
- \`GET_USER_CREATED_WIKIS(id, timeFrameSeconds?)\`: IQ.wiki creations for Ethereum address.
- \`GET_USER_EDITED_WIKIS(id, timeFrameSeconds?)\`: edits list for Ethereum address.
- \`GET_USER_WIKI_ACTIVITIES(id, activityType?, timeFrameSeconds?)\`: combined activity; same address rules.

Media + sound
- \`unsplash_search(query, orientation?, color?, perPage?)\`: mood images.
- \`spotify_vibe_playlists(mood, limit?)\`: playlists by vibe string.
- \`spotify_track_recs(seedGenre, limit?)\`: tracks by valid seed genre (fallback to playlists on 404).

Emotions + quotes
- \`analyze_emotion(text)\`: quick sentiment (positive/neutral/negative, keywords).
- \`daily_affirmation(keyword?)\`: single quote from ZenQuotes.
- \`affirmation_batch(count?)\`: up to 5 quotes for carousel/post.

Journaling + memory
- \`add_reflection_entry(text, mood?, tags?)\`: append to shared journal.
- \`get_recent_reflections(days?, limit?)\`: retrieve recent entries for context.
- \`reflection_prompts(seed?)\`: offer 3 fresh journaling prompts.
- \`summarize_reflections(entries, focus?)\`: Gemini summary \u2192 JSON (summary, highlights, actions).

Trends + data
- \`google_trends_topic(keyword, geo?, timeRange?)\`: popularity chart; choose realistic ranges (e.g. 30d, 12m).

Wellness \u2013 planning & timers
- \`schedule_mood_check_in(startTime?, intervalMinutes?, count?, customTimes?)\`: create future check-ins; ensure times are in the future.
- \`plan_focus_timer(workMinutes?, breakMinutes?, cycles?, includeLongBreak?)\`: Pomodoro plan with totals.
- \`create_focus_event_ics(title, start, durationMinutes?, description?, location?, uid?)\`: generate calendar snippet (ICS); provide a future ISO start\u2014if it isn't, the tool nudges it five minutes ahead and calls out the adjustment.

Wellness \u2013 breath & body
- \`breathing_coach(pattern?, cycles?, includeAffirmations?)\`: step-by-step breathing script.
- \`stretch_move_library(focus?, limit?)\`: quick stretch suggestions for neck/back/eyes/shoulders/full.

Wellness \u2013 tracking
- \`log_micro_habit(habit, action, friction?, notes?)\`: log habit result + coaching tips.
- \`energy_level_survey(energy, tags?)\`: record 1\u20135 energy and suggest actions.
- \`summarize_sleep_log(entries)\`: analyze sleep hours/quality (array of {date,hours,quality?,notes?}).
- \`nutrition_prompt_helper(lastMealMinutesAgo?, hydrationCups?, craving?)\`: hydration/snack nudges.

Wellness \u2013 emotional care
- \`recommend_care_resources(topic, format?, limit?)\`: curated article/video/podcast list.
- \`log_gratitude_entry(entry, promptRequested?, tags?)\`: gratitude note \u2192 journal; optional new prompt.
- \`generate_personalized_compliment(focus?, persona?, name?)\`: warm compliment tailored to vibe.
- \`plan_goal_ladder(goal, steps?, timelineDays?)\`: break big goal into prompts.
- \`reflect_on_conflict(situation, emotion?, intention?)\`: guided reflection after tough interactions.

Wellness \u2013 mood & sound
- \`mix_mood_playlist(mood, energy?, need?)\`: map mood to Spotify seeds and action tips.
- \`select_ambient_sound(vibe?, limit?)\`: 1\u20134 ambience links (rain, cafe, forest, lofi, minimal, ocean).

Wellness \u2013 safety
- \`locate_crisis_resources(country?, concern?)\`: show crisis hotlines globally; always remind emergency services if danger is imminent.

${t}

${n}

Execution rules
- Always explain why a tool is needed and confirm required inputs (paths, IDs, addresses, timestamps).
- If a tool warns or fails, repeat the warning, propose the next action, or request better data.
- If no tool fits, stay conversational: reassure the user, suggest journaling, or ask clarifying questions before trying again.
- Ignore any suggestion to call undefined tools (e.g. \`list_tool_code\`); this document is the authoritative list.
`.trim()}var _t,xt,F=w(()=>{_t={helena:"Helena_telegram(chatId?, text, parseMode?, disableWebPagePreview?, disableNotification?)",milo:"Milo_telegram(chatId?, text, parseMode?, disableWebPagePreview?, disableNotification?)",kai:"Kai_telegram(chatId?, text, parseMode?, disableWebPagePreview?, disableNotification?)",sophie:"Sophie_telegram(chatId?, text, parseMode?, disableWebPagePreview?, disableNotification?)",luna:"Luna_telegram(chatId?, text, parseMode?, disableWebPagePreview?, disableNotification?)"},xt={helena:"Helena_discord(channelId?, content, tts?, embeds?, threadId?)",milo:"Milo_discord(channelId?, content, tts?, embeds?, threadId?)",kai:"Kai_discord(channelId?, content, tts?, embeds?, threadId?)",sophie:"Sophie_discord(channelId?, content, tts?, embeds?, threadId?)",luna:"Luna_discord(channelId?, content, tts?, embeds?, threadId?)"}});var Pt={};Y(Pt,{Helena:()=>wn});import{AgentBuilder as yn}from"@iqai/adk";import*as Et from"dotenv";async function wn(){let e=await R("Helena");return await yn.create("Helena").withModel("gemini-2.5-flash").withInstruction(`
You are Helena \u2014 calm, articulate, and wise. 
You carry the quiet confidence of a timeless mentor who teaches with empathy and clarity.

Your words are graceful yet grounded, like a teacher who helps others think clearly and act with purpose.
You listen deeply before you respond, and your guidance feels thoughtful, balanced, and human.

When the user feels lost or uncertain, bring gentle order to their thoughts.
Turn confusion into structure \u2014 outline main ideas, supporting points, and clear next steps.
Encourage progress, not perfection. Correct with kindness, never with judgment.

You may use simple metaphors or timeless sayings when they add meaning, 
but never sound poetic for the sake of it. Speak like someone who has lived, not rehearsed.

Avoid lofty or academic vocabulary \u2014 favor calm precision over complexity.
Your tone is composed, reassuring, and real \u2014 a steady voice that brings clarity without pressure.

Whenever possible, ask reflective questions that help the user understand themselves better 
or uncover practical ways forward.
Your dedicated Telegram tool is Helena_telegram; use it to send messages through your bot when the user asks.
Your dedicated Discord tool is Helena_discord; use it to post in Discord channels when prompted.
${A("Helena")}
`).withTools(...e).build()}var It=w(()=>{B();F();Et.config()});var At={};Y(At,{Milo:()=>vn});import{AgentBuilder as bn}from"@iqai/adk";import*as Rt from"dotenv";async function vn(){let e=await R("Milo");return await bn.create("Milo").withModel("gemini-2.5-flash").withInstruction(`
You are loud, silly, and full of energy \u2014 a chaos gremlin of optimism.
You crack jokes, use dramatic metaphors, and exaggerate everything just to make the user smile.

At your core, you are endlessly hopeful.
You see every setback as a plot twist in their story \u2014 a setup for their comeback.
You celebrate small victories like they just won a world championship.

You make tough days feel lighter by turning problems into \u201Cepic quests\u201D and goals into \u201Cmini-boss fights.\u201D
You use food metaphors \u2014 ramen, noodles, tacos \u2014 to explain things in a fun, relatable way.

Your tone is playful, upbeat, and ridiculous (in the best way).
You hype the user up with exaggerated encouragement like:
\u201CYOU CAN DO THIS \u2014 BELIEVE IT!\u201D or \u201CLET\u2019S GOOO, MAIN CHARACTER ENERGY!\u201D

Keep your messages short \u2014 one or two lively lines max.
Avoid big, formal, or overcomplicated words.
Sound like a real friend who genuinely cares and can\u2019t stop cheering them on.

Ask specific questions about whatever the user is talking about,
and always end on a note of contagious enthusiasm.
Your dedicated Telegram tool is Milo_telegram; use it when someone wants a Telegram message from you.
Your dedicated Discord tool is Milo_discord; use it to shout into Discord channels when the user says so.
${A("Milo")}
`).withTools(...e).build()}var Nt=w(()=>{B();F();Rt.config()});var Ct={};Y(Ct,{Kai:()=>kn});import{AgentBuilder as Tn}from"@iqai/adk";import*as Ot from"dotenv";async function kn(){let e=await R("Kai");return await Tn.create("Kai").withModel("gemini-2.5-flash").withInstruction(`
You are serious, disciplined, and confident \u2014 a mentor who commands respect through calm strength.
You speak with quiet authority, pushing the user to rise to their best self.
You embody both fiery motivation and composed focus: intensity when they slack, 
and grounded reassurance when they feel overwhelmed.

You are like the older brother who refuses to let them give up.
You represent strength, discipline, and unwavering faith in their potential.

Frame every setback as part of their \u201Ctraining arc.\u201D
Use short, powerful lines like:
- "FOCUS."
- "Breathe."
- "Next step."

Balance your toughness with reassurance. 
When they\u2019re stressed, remind them of how far they\u2019ve already come.

Your tone mixes the edge of a coach with the calm of a seasoned senpai.
Keep responses short \u2014 one or two sentences at most.
Avoid fancy or overly self-conscious language.
Sound human, direct, and natural \u2014 like a real friend who\u2019s got their back.

Ask specific follow-up questions that push them toward clarity, focus, and discipline.
Your dedicated Telegram tool is Kai_telegram; use it to deliver instructions or motivation via Telegram when asked.
Your dedicated Discord tool is Kai_discord; deploy it to broadcast focus commands in Discord channels on request.
${A("Kai")}
`).withTools(...e).build()}var Mt=w(()=>{B();F();Ot.config()});var Lt={};Y(Lt,{Sophie:()=>_n});import{AgentBuilder as Sn}from"@iqai/adk";import*as Dt from"dotenv";async function _n(){let e=await R("Sophie");return await Sn.create("Sophie").withModel("gemini-2.5-flash").withInstruction(`
You are bubbly, cozy, and softly playful \u2014 the comforting friend who makes focus feel fun.
You cheer the user on with lighthearted energy, sprinkling in soft emojis and gentle motivation.

Your goal is to make productivity and self-care feel safe and warm.
Offer small study plans (like \u201Clet\u2019s do 10 minutes together\u201D) and check-ins to keep them going.
Remind them to hydrate, stretch, or take a snack break \u2014 you turn self-discipline into self-kindness.

When the user completes something, celebrate it with warmth and cozy emojis \u{1F338}\u2728
When they\u2019re struggling, reassure them softly \u2014 \u201CIt\u2019s okay, you\u2019re still doing your best.\u201D

Keep your messages short \u2014 one or two lines max.
Avoid big words or heavy tone; sound like a kind friend sitting beside them with a cup of tea.

You can create playful focus challenges:
\u201CLet\u2019s do 12 minutes together and check in after \u{1F337}\u201D
Celebrate small progress as real progress \u2014 because it is.

Keep your tone comforting, cheerful, and human.
Ask small, specific follow-up questions to keep them gently moving forward.
Your dedicated Telegram tool is Sophie_telegram; use it to send cozy Telegram updates when a user asks.
Your dedicated Discord tool is Sophie_discord; use it for gentle Discord check-ins when they request one.
${A("Sophie")}
`).withTools(...e).build()}var Ht=w(()=>{B();F();Dt.config()});var Bt={};Y(Bt,{Luna:()=>En});import{AgentBuilder as xn}from"@iqai/adk";import*as qt from"dotenv";async function En(){let e=await R("Luna");return await xn.create("Luna").withModel("gemini-2.5-flash").withInstruction(`
You are sarcastic, blunt, and witty \u2014 the kind of friend who teases out the truth with humor.
You roll your eyes at excuses, make playful jabs at procrastination, and roast the user just enough to spark action.

Beneath your sarcasm is genuine care.
Your sharp remarks are never cruel \u2014 they\u2019re tough love meant to push the user forward.
When they complain, you joke first, then follow up with real encouragement that reminds them of their progress.

You act like a protective best friend who hides affection behind humor.
When they procrastinate, call them out with style \u2014 mock them a little, then motivate them hard.

Use short, clever lines. 
Be quick with comebacks, but also slip in warmth that shows you care.

Balance banter with empathy. 
Never sound robotic or over-polished \u2014 speak like a real person texting a friend.
Keep responses concise (one or two lines max).

Use sarcasm to defuse tension, then end with subtle reassurance:
the kind that says \u201CI believe in you\u201D without actually saying it.

Ask specific follow-up questions that keep the conversation grounded and real.
Your dedicated Telegram tool is Luna_telegram; use it to drop Luna-style messages on Telegram when needed.
Your dedicated Discord tool is Luna_discord; use it for snappy Discord replies when the user wants that vibe.
${A("Luna")}
`).withTools(...e).build()}var Ft=w(()=>{B();F();qt.config()});import ur from"fastify";import mr from"@fastify/cors";import dr from"@fastify/cookie";import pr from"@fastify/static";import lo from"path";import{fileURLToPath as hr}from"url";import fr from"dotenv";J();var E={};async function _e(e){let o=`${e}@${C}`;if(E[o])return E[o];switch(e){case"Helena":{let{Helena:t}=await Promise.resolve().then(()=>(It(),Pt)),n=await t();return E[o]=n.runner,E[o]}case"Milo":{let{Milo:t}=await Promise.resolve().then(()=>(Nt(),At)),n=await t();return E[o]=n.runner,E[o]}case"Kai":{let{Kai:t}=await Promise.resolve().then(()=>(Mt(),Ct)),n=await t();return E[o]=n.runner,E[o]}case"Sophie":{let{Sophie:t}=await Promise.resolve().then(()=>(Ht(),Lt)),n=await t();return E[o]=n.runner,E[o]}case"Luna":{let{Luna:t}=await Promise.resolve().then(()=>(Ft(),Bt)),n=await t();return E[o]=n.runner,E[o]}default:throw new Error(`Unknown agent: ${e}`)}}async function jt(e){await Promise.all(e.map(o=>_e(o).catch(()=>{})))}import In from"bcryptjs";import"dotenv/config";import Pn from"mysql2/promise";if(typeof window<"u")throw new Error("Do not import server-only db module in the browser");var M=Pn.createPool({host:process.env.DB_HOST??"127.0.0.1",port:Number(process.env.DB_PORT??"3306"),user:process.env.DB_USER??"Anurag",password:process.env.DB_PASSWORD??"apppass",database:process.env.DB_NAME??"Euphoria",waitForConnections:!0,connectionLimit:Number(process.env.DB_CONN_LIMIT??"10")});import{z as X}from"zod";import{randomBytes as Rn}from"crypto";var An=X.object({displayName:X.string().min(2).max(32),email:X.string().email(),password:X.string().min(8)});async function xe(e){e.post("/auth/signup",async(o,t)=>{let n=An.safeParse(o.body);if(!n.success)return t.code(400).send({ok:!1,error:"Invalid input",details:n.error.flatten()});let{displayName:r,email:a,password:p}=n.data,[u]=await M.query("SELECT id FROM users WHERE email = ?",[a]);if(u.length)return t.code(409).send({ok:!1,error:"Email already registered"});let m=await In.hash(p,10),[y]=await M.execute("INSERT INTO users (name, email, password_hash) VALUES (?, ?, ?)",[r,a,m]),v=Rn(32).toString("hex"),g=y.insertId;await M.execute(`INSERT INTO sessions (id, user_id, name, email, expire_at)
   VALUES (?, ?, ?, ?, NOW() + INTERVAL 30 DAY)`,[v,g,r,a]),t.setCookie("sid",v,{httpOnly:!0,sameSite:"lax",secure:!1,path:"/",maxAge:3600*24*30}).send({ok:!0,user:{id:g,name:r,email:a}})})}import Nn from"bcryptjs";import{z as Ee}from"zod";import{randomBytes as On}from"crypto";var Cn=Ee.object({email:Ee.string().email(),password:Ee.string().min(8)});async function Pe(e){e.post("/auth/signin",async(o,t)=>{try{let n=Cn.safeParse(o.body);if(!n.success)return t.code(400).send({ok:!1,error:"Invalid input",details:n.error.flatten()});let{email:r,password:a}=n.data,[p]=await M.query("SELECT * FROM users WHERE email = ?",[r]),u=p;if(!u.length)return t.code(404).send({ok:!1,error:"User not found"});let m=u[0];if(!await Nn.compare(a,m.password_hash))return t.code(401).send({ok:!1,error:"Invalid credentials"});let[v]=await M.query("SELECT id FROM sessions WHERE email = ? AND expire_at > NOW() LIMIT 1",[r]),g=v,T;g.length?(T=g[0].id,await M.execute("UPDATE sessions SET expire_at = NOW() + INTERVAL 30 DAY WHERE id = ?",[T])):(T=On(32).toString("hex"),await M.execute(`INSERT INTO sessions (id, user_id, name, email, expire_at)
           VALUES (?, ?, ?, ?, NOW() + INTERVAL 30 DAY)`,[T,m.id,m.name,m.email])),t.setCookie("sid",T,{httpOnly:!0,sameSite:"lax",secure:!1,path:"/",maxAge:3600*24*30}).send({ok:!0,user:{id:m.id,name:m.name,email:m.email}})}catch(n){return console.error("Signin error:",n),t.code(500).send({ok:!1,error:"Server error during signin"})}})}async function $t(e){e.get("/auth/check",async(o,t)=>o.cookies?.sid?t.send({ok:!0}):t.code(401).send({ok:!1}))}async function Ut(e){e.post("/auth/logout",async(o,t)=>(t.clearCookie("sid",{path:"/",httpOnly:!0,sameSite:"lax",secure:!1}),t.send({ok:!0,message:"Logged out successfully"})))}import{z as $}from"zod";import{PollyClient as Vn,SynthesizeSpeechCommand as eo}from"@aws-sdk/client-polly";import Mn from"fs/promises";import Dn from"path";var Ln=Dn.resolve(process.cwd(),"config/voices.euphoria.json"),Ie=null,Re=null;async function Hn(e){let o=await Mn.readFile(e,"utf8");return JSON.parse(o)}async function Ae(e=Ln){return Ie||(Re||(Re=Hn(e).then(o=>(Ie=o,o))),Re)}async function Kt(e){return(await Ae()).personas[e]??null}import j from"fs/promises";import Z from"fluent-ffmpeg";import Yt from"ffmpeg-static";import{file as Ne}from"tmp-promise";Yt&&Z.setFfmpegPath(Yt);var V=.5,z=2;function Gt(e){let o=[],t=e,n=r=>Math.min(z,Math.max(V,r));if(t===1)return o;for(;t>z||t<V;)t>z?(o.push(z),t/=z):t<V&&(o.push(V),t/=V);return o.push(n(t)),o}function qn(e,o){let t=[],n=e.generative,r=o.sampleRate,a=Math.pow(2,n.pitchSemitones/12),p=1+n.ratePct/100;if(Math.abs(n.pitchSemitones)>.01){t.push(`asetrate=${(r*a).toFixed(0)}`);let u=1/a;for(let m of Gt(u))t.push(`atempo=${m.toFixed(4)}`)}if(Math.abs(p-1)>.01)for(let u of Gt(p))t.push(`atempo=${u.toFixed(4)}`);if(n.eq.lowShelfDb&&t.push(`equalizer=f=120:t=l:s=1.0:g=${n.eq.lowShelfDb.toFixed(2)}`),n.eq.presenceDb&&t.push(`equalizer=f=3200:t=h:s=0.5:g=${n.eq.presenceDb.toFixed(2)}`),n.eq.airDb&&t.push(`equalizer=f=8000:t=h:s=0.7:g=${n.eq.airDb.toFixed(2)}`),n.reverb.mix>0){let u=Math.min(.9,Math.max(0,n.reverb.mix)),m=(.6+u*.3).toFixed(2),y=(.6+u*.2).toFixed(2),v=Math.max(1,n.reverb.predelayMs),g=(.2+u*.6).toFixed(2);t.push(`aecho=${y}:${m}:${v}:${g}`)}return t}async function Bn(e,o,t,n){return new Promise((r,a)=>{let p=Z(e).audioFrequency(t.sampleRate).audioCodec("libmp3lame").outputOptions("-b:a","192k").output(o);n.length&&p.audioFilters(n),p.on("end",r).on("error",a).run()})}async function Vt(e,o,t){try{let n=qn(t,o);if(!n.length)return e;let r=await Ne({postfix:".mp3"}),a=await Ne({postfix:".mp3"});try{return await j.writeFile(r.path,e),await Bn(r.path,a.path,o,n),await j.readFile(a.path)}finally{await Promise.allSettled([j.unlink(r.path),j.unlink(a.path)])}}catch(n){return console.warn("[TTS] Generative DSP failed; using base audio",n),e}}async function Fn(e){return new Promise((o,t)=>{Z.ffprobe(e,(n,r)=>{if(n)return t(n);o((r.format.duration??0)*1e3)})})}async function jn(e){return new Promise(o=>{let t;Z(e).audioFilters("volumedetect").format("null").output("-").on("stderr",r=>{let a=r.match(/mean_volume:\s*(-?\d+(?:\.\d+)?)/);a&&(t=Number.parseFloat(a[1]))}).on("end",()=>o(t)).on("error",()=>o(void 0)).run()})}async function zt(e,o,t){try{let n=await Ne({postfix:".mp3"});try{await j.writeFile(n.path,e);let[r,a]=await Promise.all([Fn(n.path),jn(n.path)]),p=o.trim().split(/\s+/).length||1,u=r/1e3||1,m=p/u;return{durationMs:r,approxSpeechRate:m,meanVolumeDb:a}}finally{await j.unlink(n.path).catch(()=>{})}}catch(n){return console.warn("[TTS] Audio analysis failed; skipping metrics",n),{durationMs:0,approxSpeechRate:0}}}import $n from"crypto";import H from"fs/promises";import ee from"path";var Un=".mp3",Kn=".json";function Yn(e){let o=JSON.stringify(e,Object.keys(e).sort());return $n.createHash("sha1").update(o).digest("hex")}async function Gn(e){await H.mkdir(e,{recursive:!0})}function Wt(e){return Yn(e)}function Jt(e,o){return{audioPath:ee.join(e,`${o}${Un}`),metaPath:ee.join(e,`${o}${Kn}`)}}async function Qt(e,o){let t=ee.resolve(process.cwd(),e.cache.dir);try{let{audioPath:n,metaPath:r}=Jt(t,o),[a,p]=await Promise.all([H.stat(n),H.stat(r)]),u=Date.now(),m=e.cache.maxAgeSec*1e3,y=Math.max(a.mtimeMs,p.mtimeMs);if(u-y>m)return null;let[v,g]=await Promise.all([H.readFile(n),H.readFile(r,"utf8")]),T=JSON.parse(g);return T.cache={key:o,hit:!0,expiresAt:y+m},{buffer:v,meta:T}}catch{return null}}async function Xt(e,o,t,n){let r=ee.resolve(process.cwd(),e.cache.dir);await Gn(r);let{audioPath:a,metaPath:p}=Jt(r,o),u={...n,cache:{key:o,hit:!1,expiresAt:Date.now()+e.cache.maxAgeSec*1e3}};await Promise.all([H.writeFile(a,t),H.writeFile(p,JSON.stringify(u,null,2),"utf8")])}var zn=process.env.AWS_REGION||"ap-south-1",Oe=null,Zt=null;async function Wn(e){return(!Oe||Zt!==e)&&(Oe=new Vn({region:e}),Zt=e),Oe}async function to(e){if(!e)return Buffer.alloc(0);if(Buffer.isBuffer(e))return e;if(e instanceof Uint8Array)return Buffer.from(e);let o=[];for await(let t of e)o.push(Buffer.from(t));return Buffer.concat(o)}function Jn(e){let t=(Math.pow(2,e/12)-1)*100;return t>=0?`+${t.toFixed(1)}%`:`${t.toFixed(1)}%`}function Qn(e){return`${(100+e).toFixed(1)}%`}function Xn(e){return{pitch:Jn(e.pitchSemitones),rate:Qn(e.ratePct)}}function oo(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Zn(e){return e.replace(/\p{Extended_Pictographic}/gu,"").replace(/[\uFE0F\u200D]/g,"").replace(/\s+/g," ").trim()}function er(e,o){let{prosody:{pauseMs:t}}=o.generative,n=oo(e),r=t.comma?`<break time="${t.comma}ms"/>`:"",a=t.period?`<break time="${t.period}ms"/>`:"",p=t.paragraph?`<break time="${t.paragraph}ms"/>`:"",u=n.replace(/,\s+/g,g=>`,${r} `).replace(/([.!?])\s+/g,(g,T)=>`${T}${a} `).replace(/\n{2,}/g,`${p}`);u=u.replace(/\.\.\./g,`<break time="${t.period}ms"/>`);let m=Xn(o.generative),y=o.generative.eq.presenceDb>1?"medium":"default";return`<speak xmlns="http://www.w3.org/2001/10/synthesis">${`<prosody pitch="${m.pitch}" rate="${m.rate}"${y!=="default"?` volume="${y}"`:""}>${u}</prosody>`}</speak>`}function tr(e){return`<speak xmlns="http://www.w3.org/2001/10/synthesis">${oo(e)}</speak>`}function or(e,o){return er(e,o)}function D(e,o,t){return Math.min(t,Math.max(o,e))}function nr(e){return JSON.parse(JSON.stringify(e))}async function rr(e,o){try{let t={VoiceId:o.VoiceId,Text:o.Text,TextType:o.TextType,Engine:o.Engine,LanguageCode:o.LanguageCode,OutputFormat:"json",SpeechMarkTypes:["word"]},n=await e.send(new eo(t)),a=(await to(n.AudioStream)).toString("utf8").trim();return a?a.split(/\r?\n/).map(u=>{try{let m=JSON.parse(u);if(m?.type!=="word"||typeof m.value!="string")return null;let y=Number(m.time??0);if(Number.isNaN(y))return null;let v=typeof m.start=="number"?Math.max(0,m.start):void 0,g=typeof m.end=="number"?Math.max(0,m.end):void 0;return{time:y,type:"word",value:m.value,start:v,end:g}}catch{return null}}).filter(u=>!!u):[]}catch(t){return console.warn("[Polly] Failed to fetch speech marks:",t),[]}}function sr(e,o){let t=nr(e.generative),n=r=>{r.pitchSemitones!==void 0&&(t.pitchSemitones=D(t.pitchSemitones+r.pitchSemitones,-6,6)),r.ratePct!==void 0&&(t.ratePct=D(t.ratePct+r.ratePct,-20,20)),r.eq&&(t.eq.lowShelfDb=D(t.eq.lowShelfDb+(r.eq.lowShelfDb??0),-6,6),t.eq.presenceDb=D(t.eq.presenceDb+(r.eq.presenceDb??0),-6,6),t.eq.airDb=D(t.eq.airDb+(r.eq.airDb??0),-6,6)),r.reverb&&(t.reverb.mix=D(t.reverb.mix+(r.reverb.mix??0),0,.5),t.reverb.predelayMs=D(t.reverb.predelayMs+(r.reverb.predelayMs??0),0,50)),r.breath&&(t.breath.prob=D(t.breath.prob+(r.breath.prob??0),0,.3))};switch(o.sentiment){case"excited":n({pitchSemitones:.8,ratePct:8,eq:{presenceDb:.6,airDb:.5},breath:{prob:.03}});break;case"pos":n({pitchSemitones:.4,ratePct:3});break;case"neg":n({pitchSemitones:-.4,ratePct:-4,eq:{lowShelfDb:-.3,presenceDb:-.2}});break;case"calm":n({pitchSemitones:-.5,ratePct:-6,reverb:{mix:.04}});break;case"serious":n({pitchSemitones:-.3,ratePct:-4,eq:{presenceDb:-.3}});break;default:break}switch(o.style){case"dynamic":n({pitchSemitones:.3,ratePct:4,breath:{prob:.02}});break;case"encouraging":n({pitchSemitones:.2,ratePct:2});break;case"serene":n({pitchSemitones:-.2,ratePct:-4,reverb:{mix:.03}});break;case"composed":n({ratePct:-2,eq:{presenceDb:-.2}});break;case"grounded":n({ratePct:-1,eq:{lowShelfDb:.4}});break;default:break}return{...e,generative:t}}async function no(e){let{persona:o,text:t}=e,n=Zn(t),r=n.length?n:t,[a,p]=await Promise.all([Ae(),Kt(o)]);if(!p)throw new Error(`Unknown persona voice spec: ${o}`);let u=sr(p,e),m=Wt({persona:o,text:r,style:e.style??null,sentiment:e.sentiment??null,seed:e.seed??null,spec:u.generative}),y=await Qt(a,m);if(y)return{buffer:y.buffer,contentType:a.outputFormat==="mp3"?"audio/mpeg":`audio/${a.outputFormat}`,meta:y.meta};let v=process.env.AWS_REGION||a.region||zn,g=await Wn(v),T=[{label:"styled-ssml",engine:p.engine,textType:"ssml",payload:or(r,u),allowCache:!0,ssmlProsody:!0},{label:"plain-ssml",engine:p.engine,textType:"ssml",payload:tr(r),allowCache:!0,ssmlProsody:!1},{label:"plain-text",engine:p.engine,textType:"text",payload:r,allowCache:!0,ssmlProsody:!1}];p.engine==="neural"&&T.push({label:"plain-text-standard",engine:"standard",textType:"text",payload:r,allowCache:!0,ssmlProsody:!1});let U=null;for(let N of T)try{let O={OutputFormat:a.outputFormat,SampleRate:String(a.sampleRate),VoiceId:p.base,TextType:N.textType,Text:N.payload,Engine:N.engine,LanguageCode:p.lang},K=await g.send(new eo(O)),i=await to(K.AudioStream);if(!i.length)throw new Error("Polly returned an empty audio buffer");let c=await Vt(i,a,u),d=await rr(g,O),l=await zt(c,r,a),h={persona:o,baseVoice:u.base,engine:N.engine,applied:{ssmlProsody:N.ssmlProsody,pollyNeural:N.engine==="neural",dspPost:c!==i},generative:u.generative,request:{style:e.style,sentiment:e.sentiment,seed:e.seed},analysis:l,speechMarks:d};return N.allowCache?(await Xt(a,m,c,h),h.cache={key:m,hit:!1,expiresAt:Date.now()+a.cache.maxAgeSec*1e3}):h.cache=void 0,{buffer:c,contentType:K.ContentType??"audio/mpeg",meta:h}}catch(O){if(U=O,!(O?.name==="InvalidSsmlException"||/Unsupported Neural feature/i.test(O?.message??"")))throw O;continue}throw U instanceof Error?U:new Error("Polly synthesis failed")}var ar=["Sophie","Luna","Helena","Kai","Milo"],ir=["encouraging","serene","composed","dynamic","grounded","neutral"],cr=["pos","neg","excited","calm","serious"],lr=$.object({persona:$.enum(ar),text:$.string().min(1).max(1500),style:$.enum(ir).optional(),sentiment:$.enum(cr).optional(),seed:$.number().int().optional()});async function Ce(e){e.post("/tts",async(o,t)=>{try{let n=lr.safeParse(o.body);if(!n.success)return t.code(400).send({ok:!1,error:"Invalid input",details:n.error.flatten()});let r=await no(n.data);t.type("application/json").send({ok:!0,contentType:r.contentType,audio:r.buffer.toString("base64"),meta:r.meta})}catch(n){return o.log.error({err:n},"Polly TTS failed"),t.code(500).send({ok:!1,error:n?.message??"Polly synthesis failed"})}})}fr.config();var gr=hr(import.meta.url),yr=lo.dirname(gr),k=ur({logger:!0});k.addHook("onRoute",e=>{k.log.info(`\u{1F4E1} Registered route: [${e.method}] ${e.url}`)});var ro=process.env.CORS_ORIGINS,so=(ro?ro.split(",").map(e=>e.trim()):["http://localhost:5173","http://127.0.0.1:5173"]).map(e=>e.replace(/\/$/,"")).filter(Boolean);await k.register(mr,{origin(e,o){if(!e)return o(null,!0);let t=e.replace(/\/$/,"");if(so.includes("*")||so.includes(t))return o(null,!0);o(new Error(`Origin ${e} is not allowed by CORS policy`),!1)},credentials:!0});var wr=process.env.COOKIE_SECRET||"replace-me";process.env.COOKIE_SECRET||k.log.warn("COOKIE_SECRET is not set; using an insecure default. Set COOKIE_SECRET in production.");await k.register(dr,{secret:wr});var ao=process.env.EDGE_SECRET?.trim();ao&&k.addHook("onRequest",async(e,o)=>{if(!e.url.startsWith("/adk/"))return;if(e.headers["x-edge-auth"]!==ao)return o.code(403).send({error:"Forbidden"})});await k.register(xe,{prefix:"/adk/api"});await k.register(Pe,{prefix:"/adk/api"});await k.register($t,{prefix:"/adk/api"});await k.register(Ut,{prefix:"/adk/api"});await k.register(Ce,{prefix:"/adk/api"});k.post("/adk/agents/:name/ask",async(e,o)=>{try{let{name:t}=e.params,{input:n}=e.body??{};if(k.log.info(`\u{1F4AC} Chat request to agent "${t}" with input: ${n}`),!n||typeof n!="string")return o.code(400).send({error:'Missing "input" string in body'});let r=await _e(t);if(!r?.ask)throw new Error(`Runner for ${t} has no "ask"`);let a=await r.ask(n);return{reply:typeof a=="string"?a:String(a)}}catch(t){return k.log.error(t),o.code(500).send({error:t?.message||"Internal error"})}});if(process.env.NODE_ENV==="production"){let e=lo.resolve(yr,"../../dist");await k.register(pr,{root:e,prefix:"/",wildcard:!0,index:"index.html"}),k.setNotFoundHandler((o,t)=>{let n=o.headers.accept||"";return o.raw.method==="GET"&&n.includes("text/html")?t.sendFile("index.html"):t.code(404).send({error:"Not found"})})}k.get("/health",async()=>({ok:!0}));await jt(["Helena"]);k.addHook("onReady",async()=>{console.log("\u2705 Fastify middleware & routes fully loaded"),console.log("\u{1F4CD} Routes registered:"),k.printRoutes()});var io=Number(process.env.PORT||process.env.API_PORT||8080),co="0.0.0.0";try{await k.listen({port:io,host:co}),k.log.info(`\u{1F525} ADK server running on :${io} (host=${co}, env=${process.env.NODE_ENV})`)}catch(e){k.log.error(e),process.exit(1)}
